# TFG GaussianTalker 项目结构说明


---

##  整体项目结构

```
TFG_ui_GaussianTalker/                    # 项目根目录
├── app.py                                # ✅ Flask主应用（已完成）
├── requirements.txt                      # Python依赖列表
├── README.md                             # 项目主文档
├── 项目结构说明.md                       # 本文档
│
├── backend/                              # ✅ 后端服务模块（基础已完成）
│   ├── __init__.py
│   ├── model_trainer.py                  # ✅ 模型训练接口
│   ├── video_generator.py                # ✅ 视频生成接口
│   └── chat_engine.py                    # ⏳ 实时对话引擎（需完善）
│
├── templates/                            # 前端HTML模板
│   ├── index.html                        # 首页
│   ├── model_training.html               # 模型训练页面
│   ├── video_generation.html             # 视频生成页面
│   └── chat_system.html                  # 实时对话页面
│
├── static/                               # 静态资源
│   ├── css/
│   │   └── style.css                     # 样式文件
│   ├── videos/                           # 生成的视频文件
│   ├── audios/                           # 音频文件
│   └── text/                             # 文本文件
│
├── GaussianTalker/                       # ✅ GaussianTalker模型（框架已完成）
│   ├── 【详见下方GaussianTalker详细结构】
│
├── SyncTalk/                             # SyncTalk模型（示例参考）
│   ├── Dockerfile
│   ├── run_synctalk.sh
│   └── SyncTalk_Docker调用说明.md
│
└── VoiceClone/                           # ⏳ 语音克隆模块（待创建）
    └── 【待实现】
```

---

##  核心模块详解

### 1. Flask应用层 (`app.py`) ✅

**状态**: 基础功能已完成  
**主要功能**:
- 提供Web服务器
- 定义路由和API接口
- 连接前端和后端

**主要路由**:
```python
/                      # 首页
/model_training        # 模型训练页面
/video_generation      # 视频生成页面  
/chat_system          # 实时对话页面
/save_audio           # 保存音频API
```



---

### 2. 后端服务模块 (`backend/`) ✅

#### 2.1 `model_trainer.py` - 模型训练接口 ✅

**状态**: 基础功能已完成  

**功能**:
- 接收前端训练请求
- 调用Docker容器执行模型训练
- 支持SyncTalk和GaussianTalker两种模型

**主要函数**:
```python
train_model(data)  # 训练模型主函数
```

**参数**:
- `model_choice`: 模型选择 (SyncTalk/GaussianTalker)
- `ref_video`: 训练视频路径
- `gpu_choice`: GPU设备 (GPU0/GPU1/CPU)
- `epoch`/`iterations`: 训练轮数
- `config`: 配置文件（GaussianTalker专用）



---

#### 2.2 `video_generator.py` - 视频生成接口 ✅

**状态**: 基础功能已完成  

**功能**:
- 接收推理请求
- 调用Docker容器生成视频
- 处理生成视频的文件管理

**主要函数**:
```python
generate_video(data)  # 视频生成主函数
```

**参数**:
- `model_name`: 模型名称 (SyncTalk/GaussianTalker)
- `model_param`: 模型目录
- `ref_audio`: 驱动音频路径
- `gpu_choice`: GPU设备
- `batch_size`: 批处理大小（GaussianTalker专用）
- `iteration`: 检查点迭代数（GaussianTalker专用）


---

#### 2.3 `chat_engine.py` - 实时对话引擎 ⏳

**状态**: 基础框架已有，需大幅完善  

**当前功能**:
- ✅ ASR（语音识别）- 使用speech_recognition
- ✅ AI回复生成 - 使用智谱AI API
- ❌ TTS（文本转语音）- 未实现
- ❌ 语音克隆 - 未实现

**待实现**:
1. 集成TTS引擎
2. 实现语音克隆功能
3. 整合GaussianTalker生成数字人视频
4. 优化对话流程

**关键函数**:
```python
chat_response(data)           # 主函数
audio_to_text(input, output)  # ASR
get_ai_response(input, output, api_key, model)  # AI回复
# TODO: text_to_speech()      # TTS（待实现）
# TODO: clone_voice()          # 语音克隆（待实现）
```

---

### 3. 前端模块 (`templates/`, `static/`) ⏳

**状态**: 基础界面已有，需优化  
**负责人**: 前端开发人员

#### 3.1 页面结构

**`index.html` - 首页**
- 展示系统功能
- 导航到各个子页面

**`model_training.html` - 模型训练页面**
- 上传训练视频
- 选择模型和参数
- 显示训练结果

**`video_generation.html` - 视频生成页面**
- 选择模型
- 上传音频
- 播放生成视频

**`chat_system.html` - 实时对话页面**
- 录音功能
- 实时对话
- 视频展示

#### 3.2 待优化内容

- [ ] UI美观性提升
- [ ] 交互流畅性优化
- [ ] 加载动画和进度条
- [ ] 错误提示优化
- [ ] 响应式设计
- [ ] 拓展功能（皮肤更换、字体选择、音频升降调等）

---

##  GaussianTalker模型详细结构

### 目录结构

```
GaussianTalker/
├── 📄 核心配置文件 ✅
│   ├── Dockerfile                        # Docker镜像配置
│   ├── .dockerignore                     # Docker忽略文件
│   ├── run_gaussiantalker.sh             # 统一运行脚本
│   ├── download_pretrained.sh            # 预训练模型下载
│   ├── requirements.txt                  # Python依赖
│   └── GaussianTalker_Docker调用说明.md  # 使用文档
│
├── 📜 主程序脚本 ✅
│   ├── train.py                          # 训练脚本
│   └── render.py                         # 推理渲染脚本
│
├── ⚙️ arguments/                         # 配置文件目录 ✅
│   ├── __init__.py                       # 参数解析主文件
│   ├── 64_dim_1_transformer.py           # 1层Transformer配置
│   └── 64_dim_2_transformer.py           # 2层Transformer配置
│
├── 🎨 scene/                             # 场景和模型定义 ✅
│   ├── __init__.py
│   ├── gaussian_model.py                 # 3D Gaussian模型
│   ├── deformation.py                    # 变形网络
│   ├── dataset_readers.py                # 数据集读取
│   ├── talking_dataset_readers.py        # 说话人脸数据集
│   ├── provider.py                       # 数据提供器
│   ├── camera.py                         # 相机模型
│   ├── cameras.py                        # 相机集合
│   ├── networks.py                       # 神经网络定义
│   └── transformer/                      # Transformer模块
│       ├── transformer.py
│       ├── multi_head_attention.py
│       ├── scale_dot_product_attention.py
│       ├── position_wise_feed_forward.py
│       └── layer_norm.py
│
├── 🔧 data_utils/                        # 数据处理工具 ✅
│   ├── process.py                        # 数据预处理主脚本
│   ├── hubert.py                         # Hubert音频特征
│   ├── wav2vec.py                        # Wav2Vec特征提取
│   ├── wav2mel.py                        # 音频转Mel频谱
│   ├── wav2mel_hparams.py                # Mel频谱超参数
│   │
│   ├── face_parsing/                     # 人脸解析
│   │   ├── model.py                      # 解析模型
│   │   ├── resnet.py                     # ResNet backbone
│   │   └── test.py                       # 测试脚本
│   │
│   ├── face_tracking/                    # 人脸跟踪
│   │   ├── face_tracker.py               # 人脸跟踪器
│   │   ├── facemodel.py                  # 3DMM人脸模型
│   │   ├── convert_BFM.py                # BFM模型转换
│   │   ├── render_3dmm.py                # 3DMM渲染
│   │   ├── render_land.py                # 关键点渲染
│   │   └── 3DMM/                         # 3DMM模型文件
│   │       ├── exp_info.npy
│   │       ├── keys_info.npy
│   │       ├── sub_mesh.obj
│   │       └── topology_info.npy
│   │
│   └── deepspeech_features/              # DeepSpeech特征
│       ├── extract_ds_features.py        # 特征提取
│       ├── deepspeech_features.py        # DeepSpeech实现
│       └── deepspeech_store.py           # 特征存储
│
├── 🎮 gaussian_renderer/                 # 高斯渲染器 ✅
│   ├── __init__.py                       # 渲染主函数
│   └── network_gui.py                    # 网络GUI
│
├── 🛠️ utils/                             # 工具函数 ✅
│   ├── camera_utils.py                   # 相机工具
│   ├── general_utils.py                  # 通用工具
│   ├── graphics_utils.py                 # 图形工具
│   ├── image_utils.py                    # 图像工具
│   ├── loss_utils.py                     # 损失函数
│   ├── point_utils.py                    # 点云工具
│   ├── pose_utils.py                     # 姿态工具
│   ├── render_utils.py                   # 渲染工具
│   ├── scene_utils.py                    # 场景工具
│   ├── sh_utils.py                       # 球谐函数工具
│   └── system_utils.py                   # 系统工具
│
├── 📦 submodules/                        # 子模块 ⏳
│   ├── custom-bg-depth-diff-gaussian-rasterization/  # 自定义光栅化
│   └── simple-knn/                       # KNN算法
│
├── 📊 lpipsPyTorch/                      # LPIPS感知损失 ✅
│   └── modules/
│       ├── lpips.py
│       ├── networks.py
│       └── utils.py
│
└── 📁 运行时目录（自动创建）
    ├── data/                             # 预处理数据
    ├── output/                           # 训练输出
    └── audio/                            # 音频文件
```

---

##  各板块分工指引

### 前端优化

**主要工作目录**:
- `templates/` - 所有HTML模板
- `static/css/` - 样式文件
- `static/` - 静态资源

**需要关注的后端接口**:
- `app.py` - 了解所有API路由
- `backend/*.py` - 了解后端返回的数据格式

**主要任务**:
1. 优化UI界面美观性
2. 提升用户交互体验
3. 添加拓展功能
4. 实现实时进度显示
5. 与后端联调测试

**参考文件**:
- `templates/chat_system.html` - 实时对话界面
- `static/css/style.css` - 当前样式

---

### GaussianTalker微调、优化、训练

**主要工作目录**:
- `GaussianTalker/` - 整个模型目录
- `backend/model_trainer.py` - 训练接口
- `backend/video_generator.py` - 推理接口

**关键文件**:
- `train.py` - 训练主程序
- `render.py` - 推理主程序
- `arguments/*.py` - 配置文件
- `data_utils/process.py` - 数据预处理

**主要任务**:
1. ✅ 基础框架已完成
2. ⏳ Docker镜像构建和测试
3. ⏳ 下载并配置预训练模型（BFM等）
4. ⏳ 使用测试数据完整训练流程
5. ⏳ 模型调试和参数优化
6. ⏳ 探索性改进
7. ⏳ 后端接口测试和微调

**快速开始**:
```bash
cd GaussianTalker
# 1. 下载预训练模型
./download_pretrained.sh
# 2. 下载BFM模型（手动）
# 3. 构建Docker镜像
docker build -t gaussiantalker .
# 4. 测试训练
./run_gaussiantalker.sh train --video_path test.mp4 --gpu GPU0
```

**重要文档**:
- `GaussianTalker_Docker调用说明.md` - 详细使用说明

---

###  实时对话

**主要工作目录**:
- `backend/chat_engine.py` - 对话引擎
- `templates/chat_system.html` - 对话界面
- 需创建: `backend/voice_cloner.py` - 语音克隆模块

**当前状态**:
- ✅ ASR（语音识别）已实现
- ✅ AI对话（智谱AI）已实现
- ❌ TTS（文本转语音）未实现
- ❌ 语音克隆未实现
- ❌ 与GaussianTalker集成未实现

**主要任务**:
1. 实现TTS引擎（推荐Coqui TTS）
2. 实现语音克隆功能
3. 整合GaussianTalker生成数字人视频
4. 优化对话流程和延迟
5. 前后端联调

**推荐技术栈**:
- TTS: Coqui TTS (XTTS-v2)
- ASR: 已有speech_recognition
- AI对话: 已有智谱AI

**参考资源**:
- Coqui TTS文档: https://github.com/coqui-ai/TTS
- 语音克隆示例代码（见项目结构说明文档）

---

###  语音克隆与云平台部署

**主要工作目录**:
- 需创建: `VoiceClone/` - 语音克隆模块
- `backend/chat_engine.py` - 集成语音克隆
- 所有Dockerfile - 云平台部署

**主要任务**:
1. 研究并选择语音克隆方案
2. 实现语音克隆功能
3. **华为云资源适配**
   - GPU显存优化
   - 模型加载优化
   - 网络传输优化
4. 整个系统的华为云部署
   - Docker镜像构建
   - 环境配置
   - 资源调度
5. 编写部署文档



---

### 📊 模型评估和评测
**需参考教师的作业要求进行符合科研要求的具体定量、定性评估，关注群内论文的评估方式，提前寻找合适的建模人。**

**主要工作目录**:
- 需创建: `evaluation/` - 评估模块

**主要任务**:
1. 实现多个评价指标（以下为参考，根据实际要求需要微调）
   - NIQE (无参考图像质量评估)
   - PSNR (峰值信噪比)
   - FID (Fréchet Inception Distance)
   - SSIM (结构相似性)
   - LSE-C (唇形同步误差 - 置信度)
   - LSE-D (唇形同步误差 - 距离)
2. Docker封装评价指标
3. 编写评估脚本
4. 生成评估报告
5. 定性/定量分析

**待创建目录结构**:
```
evaluation/
├── Dockerfile
├── run_evaluation.sh
├── requirements.txt
├── metrics/
│   ├── niqe.py
│   ├── psnr.py
│   ├── fid.py
│   ├── ssim.py
│   ├── lse_c.py
│   └── lse_d.py
├── evaluate.py
└── evaluation_Docker调用说明.md
```

**推荐库**:
- LPIPS: `lpips` (已集成在GaussianTalker中)
- FID: `pytorch-fid`
- SSIM: `pytorch_msssim` (已在requirements中)
- NIQE: `pyiqa`

---

## 🔄 工作流程图

### 模型训练流程
```
用户上传视频
    ↓
前端收集参数 → app.py接收请求
    ↓
backend/model_trainer.py
    ↓
调用 GaussianTalker/run_gaussiantalker.sh train
    ↓
Docker容器执行训练
    ↓
模型保存到 GaussianTalker/output/
```

### 视频生成流程
```
用户上传音频
    ↓
前端收集参数 → app.py接收请求
    ↓
backend/video_generator.py
    ↓
调用 GaussianTalker/run_gaussiantalker.sh infer
    ↓
Docker容器执行推理
    ↓
视频复制到 static/videos/ → 前端播放
```

### 实时对话流程（待实现）
```
用户录音
    ↓
ASR（语音识别） → backend/chat_engine.py
    ↓
AI对话生成回复文本
    ↓
TTS + 语音克隆（待实现） → 生成回复音频
    ↓
GaussianTalker生成数字人视频
    ↓
前端播放视频
```

---

##  开发规范

### Git提交规范

```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建/工具链相关
```

---

## 📚 参考资源

### 官方文档
- [GaussianTalker论文](https://arxiv.org/abs/2404.16012v2)
- [GaussianTalker GitHub](https://github.com/joungbinlee/GaussianTalker)
- [Flask文档](https://flask.palletsprojects.com/)

### 相关技术
- [3D Gaussian Splatting](https://repo-sam.inria.fr/fungraph/3d-gaussian-splatting/)
- [Coqui TTS](https://github.com/coqui-ai/TTS)
- [Basel Face Model](https://faces.dmi.unibas.ch/bfm/)

### 数据集
- [AD-NeRF数据集](https://github.com/YudongGuo/AD-NeRF)
- [HDTF数据集](https://github.com/MRzzm/HDTF)

---



